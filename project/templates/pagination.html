
{% if total_pages and total_pages > 1 %}
<nav class="flex justify-center pt-6" aria-label="Pagination">
  <div class="flex items-center gap-2">

    {# ========================================== #}
    {#          الجزء الأول: زر «السابق»          #}
    {# ========================================== #}
    {% if prev_url %}
      <a href="{{ prev_url }}#{{ page_id }}"
      id="prev_page"
         class=" relative inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 border border-gray-300 dark:border-gray-600 transition-colors duration-200">
        السابق
      </a>
    {% else %}
      <span class="relative inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-gray-400 dark:text-gray-500 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 cursor-not-allowed">
        السابق
      </span>
    {% endif %}


    {# ========================================== #}
    {#         الجزء الثاني: أرقام الصفحات        #}
    {# ========================================== #}

        {% for i in page_range %}
            {% if i == 1 or i == total %}
                <a href="?page={{ i }}{% if request.GET.q %}&q={{ request.GET.q|urlencode }}{% endif %}#{{ page_id }}" class="relative dark:text-gray-200 inline-flex items-center px-4 py-2 text-sm font-medium rounded-md
                    {% if page_obj.number == i %}
                        bg-indigo-600 text-white
                    {% else %}
                        text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 border border-gray-300 dark:border-gray-600
                    {% endif %} transition-colors duration-200">
                    {{ i }}
                </a>
            {% else %}
                {% if i >= current_page|add:"-2" and i <= current_page|add:"2" %}
                    <a href="?{{page_key}}={{ i }}#{{page_id}}" class="relative dark:text-gray-200 inline-flex items-center px-4 py-2 text-sm font-medium rounded-md
                        {% if page_num == i %}
                            bg-indigo-600 text-white
                        {% else %}
                            text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 border border-gray-300 dark:border-gray-600
                        {% endif %} transition-colors duration-200">
                        {{ i }}
                    </a>
                {% elif i == current_page|add:"-3" or page_num == current_page|add:"3"  %}
                    <span class="px-2 select-none">...</span>
                {% endif %}
            {% endif %}
        {% endfor %}

    {% comment %} {% for i in total_pages|make_list %}
        {% with page_num=forloop.counter %}

            {% if page_num == 1 or page_num == total_pages 
              or page_num >= current_page|add:"-2" and page_num <= current_page|add:"2" %}
                <a href="?page={{ page_num }}{% if request.GET.q %}&q={{ request.GET.q|urlencode }}{% endif %}#{{ page_id }}"
                    id="pagination-link" class=" relative inline-flex items-center px-4 py-2 text-sm font-medium rounded-md border transition-colors duration-200
                          {% if page_num == current_page %}
                             bg-indigo-600 text-white border-indigo-600
                          {% else %}
                             bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 border-gray-300 dark:border-gray-600
                          {% endif %}">
                    {{ page_num }}
                </a>
            {% elif page_num == current_page|add:"-3" or page_num == current_page|add:"3" %}
                <span class="relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-400">
                    …
                </span>
            {% endif %}
        {% endwith %}
    {% endfor %} {% endcomment %}
    {% if next_url %}
      <a href="{{ next_url }}#{{ page_id }}"
         class="pagination-link relative inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 border border-gray-300 dark:border-gray-600 transition-colors duration-200">
        التالي
      </a>
      {% else %}
      <span class="relative inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-gray-400 dark:text-gray-500 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 cursor-not-allowed">
        التالي
      </span>
    {% endif %}

  </div>
</nav>
{% endif %}

<script>
    document.addEventListener("DOMContentLoaded", () => {
  const paginationLinks = document.querySelectorAll("a.pagination-link");
  const paginationPrevLink = document.querySelector("a#prev_page");

  if (paginationPrevLink) {
    paginationPrevLink.addEventListener("click", (event) => {
      event.preventDefault();
      const pageParam = new URL(paginationPrevLink.href).searchParams.get("page");
      console.log(pageParam);
      if (pageParam) {
        window.location.href = `/rooms/?page=${pageParam}`;
      }
      else {
          window.location.href = `/rooms/?page=${1}`;
      }
    });
  }

  paginationLinks.forEach(link => {
    link.addEventListener("click", (event) => {
      event.preventDefault();
      const pageParam = new URL(link.href).searchParams.get("page");
      if (pageParam) {
        window.location.href = `/rooms/?page=${pageParam}`;
      }
    });
  });
});

</script>

{% comment %} {% with total=page_obj.paginator.num_pages %}
{% with current=page_obj.number %}
<nav class="flex items-center justify-center pt-6">
    <div class="flex items-center gap-2">
        {% if page_obj.has_previous %}
            <a href="?{{page_key}}={{ page_obj.previous_page_number }}#{{page_id}}" class="relative inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 border border-gray-300 dark:border-gray-600 transition-colors duration-200">
                السابق
            </a>
        {% else %}
            <span class="relative inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-gray-400 dark:text-gray-500 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 cursor-not-allowed">
                السابق
            </span>
        {% endif %}

        {% for i in page_obj.paginator.page_range %}
            {% if i == 1 or i == total %}
                <a href="?{{page_key}}={{ i }}#{{page_id}}" class="relative dark:text-gray-200 inline-flex items-center px-4 py-2 text-sm font-medium rounded-md
                    {% if page_obj.number == i %}
                        bg-indigo-600 text-white
                    {% else %}
                        text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 border border-gray-300 dark:border-gray-600
                    {% endif %} transition-colors duration-200">
                    {{ i }}
                </a>
            {% else %}
                {% if i >= current|add:"-2" and i <= current|add:"2" %}
                    <a href="?{{page_key}}={{ i }}#{{page_id}}" class="relative dark:text-gray-200 inline-flex items-center px-4 py-2 text-sm font-medium rounded-md
                        {% if page_obj.number == i %}
                            bg-indigo-600 text-white
                        {% else %}
                            text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 border border-gray-300 dark:border-gray-600
                        {% endif %} transition-colors duration-200">
                        {{ i }}
                    </a>
                {% elif i == current|add:"-3" or i == current|add:"3" %}
                    <span class="px-2 select-none">...</span>
                {% endif %}
            {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
            <a href="?{{page_key}}={{ page_obj.next_page_number }}#{{page_id}}" class="relative inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 border border-gray-300 dark:border-gray-600 transition-colors duration-200">
                التالي
            </a>
        {% else %}
            <span class="relative inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-gray-400 dark:text-gray-500 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 cursor-not-allowed">
                التالي
            </span>
        {% endif %}
    </div>
</nav>
{% endwith %}
{% endwith %} {% endcomment %}
